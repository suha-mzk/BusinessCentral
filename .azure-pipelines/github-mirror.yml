trigger:
  branches:
    include:
      - "*"

pool:
  vmImage: ubuntu-latest

variables:
  ado_repo_url: "https://$(ado_pat)@dev.azure.com/LPCH/_git/Mazik%20Nav%20to%20BC%20Upgrade"
  github_repo_url: "https://$(github_user):$(github_pat)@github.com/suha-mzk/BusinessCentral"

steps:
  - script: |
      echo "##[group]Set up Git config"
      git config --global user.name "Azure DevOps Mirror Bot"
      git config --global user.email "devops-bot@example.com"
      echo "##[endgroup]"

      echo "##[group]Clone ADO repo (mirror)"
      git clone --mirror "$(ado_repo_url)" ado-mirror
      cd ado-mirror
      echo "##[endgroup]"

      echo "##[group]Add GitHub remote"
      git remote add github "$(github_repo_url)"
      echo "##[endgroup]"

      echo "##[group]Push to GitHub"
      git push --mirror github
      echo "##[endgroup]"
    displayName: "Mirror ADO Repo to GitHub"